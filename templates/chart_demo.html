<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> 
  <link rel="stylesheet" href="/media/css/main.css" type="text/css"
        media="screen" charset="utf-8"> 
  <script src="/media/js/raphael-min.js"
          type="text/javascript" charset="utf-8"></script> 
  <script src="/media/js/g.raphael-min.js"
          type="text/javascript" charset="utf-8"></script> 
  <script src="/media/js/g.pie-min.js" type="text/javascript"
          charset="utf-8"></script> 
  <script src="/media/js/g.bar.jeremi.js" type="text/javascript"
          charset="utf-8"></script> 
  <script type="text/javascript" charset="utf-8"> 
    window.onload = function () {
    var r = Raphael("pie-chart");
    r.g.txtattr.font = "12px 'Fontin Sans', Fontin-Sans, sans-serif";    
    r.g.text(320, 100, "Interactive Pie Chart").attr({"font-size": 20});
    var pie = r.g.piechart(320, 240, 100, 
    {{ data.values }},
    { legend: [
    {% for label in data.keys %}
    "{{ label }} (%%)",
    {% endfor %}
    ],
    legendpos: "east", 
    href: ["/", "/"]
    });

    pie.hover(function () {
    this.sector.stop();
    // first two args to scale() are the scaled size. 
    this.sector.scale(1.01, 1.01, this.cx, this.cy);
    if (this.label) {
    this.label[0].stop();
    this.label[0].scale(1.5);
    this.label[1].attr({"font-weight": 800});
    }
    }, function () {
    this.sector.animate({scale: [1, 1, this.cx,
    this.cy]}, 500, "bounce");
    if (this.label) {
    this.label[0].animate({scale: 1}, 500,
    "bounce");
    this.label[1].attr({"font-weight": 400});
    }
    });    

    ///////////////////////////////////////

    var b = Raphael("bar-chart");
    b.g.txtattr.font = "12px 'Fontin Sans', Fontin-Sans, sans-serif";    
    b.g.text(320, 100, "Brisket Bar Chart").attr({"font-size": 20});

    var fin = function () {
    this.flag = r.g.popup(this.bar.x, this.bar.y,this.bar.value || "0").insertBefore(this);
    };

    var fout = function () {
    this.flag.animate({opacity: 0}, 300, function () { this.remove();});
    };

    labels = [];
    {% for x in bar_data %}
    labels.push("{{ x.sector_code }}{{ x.sector_code }}{{ x.sector_code }}");
    {% endfor %}

    var data = [
    {% for x in bar_data %}
    {{ x.amount }},
    {% endfor %}
    ]; 

    opts = {
    "type": "soft",
    "stacked": false
    };

    /* data array must be passed inside another array-- barchart fn 
       supports multiple data series so expects an array of arrays, 
       even for just one data series. Else it will treat each data
       point as one series. */
    barchart = b.g.hbarchart(10,10, 250, 200, [data], opts);
    // pass in labels NOT inside another array
    barchart.label([labels], false);    

    // add links to the labels
    for (var i=0; i< barchart.labels.length; i++) {
      barchart.labels[i].attr({'href': 'http://www.google.com'})
    }

    /* figure out the longest label text and move the chart over by
    that amount. so the labels are beside and not on top of the
    chart. */
    var far_right = 0;
    for (var i = 0; i < labels.length; i++) {
	bb = barchart.labels[i].getBBox();
        if (bb.x + bb.width > far_right) {
            far_right = bb.x + bb.width;
        }
    }
    barchart.translate(far_right);

    // end window.onload();
    };
  </script> 
</head> 
<body>
  <div id="pie-chart"></div> 
  <div id="bar-chart"></div> 
</body> 
</html>
