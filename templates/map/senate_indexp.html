{% extends "base.html" %}
{% load media %}

{% block js %}
{% css "css/wax-controls.css" %}
{% css "css/leaflet.css" %}
{% js "js/leaflet.js" %}
{% js "js/wax.leaf.min.js" %}
<!-- extrajs is where the charts are loaded and must go *before* the --
  -- div is hidden -->
{% endblock %}

{% block title %}Maps!{% endblock %}
{% block body_class %}individual{% endblock %}

{% block main %}
<h1 style="margin-left: 20px">Senate Race Independent Expenditures (of at least $50,000 total per state) 2012</h1>

<div id="mapbox_senate_indexp" style="width: 760px; height: 570px; margin-left: 20px;"></div>

<h1 style="margin-left: 20px">House Race Independent Expenditures (of at least $50,000 total per state) 2012</h1>

<div id="mapbox_house_indexp" style="width: 760px; height: 570px; margin-left: 20px;"></div>
<script type="text/javascript">
    var create_map1 = function() {
        var indexp_data = {{ map_geo_json__senate_indexp|safe }}
        var url = "http://a.tiles.mapbox.com/v3/arowland-sf.states_new.jsonp?bar=2";
        var map = new L.Map('mapbox_senate_indexp', {maxZoom: 8, maxBounds: L.LatLngBounds(new L.LatLng(-168.9258,24.4471), new L.LatLng(-66.1816,60.6360)) }) // container's id="mapbox"
        // Center the map on the lower 48, with zoom at 3
        .setView(new L.LatLng(39.9097,-95.625), 3);

        var geojsonLayer = new L.GeoJSON(null, {
            pointToLayer: function (latlng) {
                return new L.CircleMarker(latlng);
            }
        });

        wax.tilejson(url, function(tilejson) {
            map.addLayer(new wax.leaf.connector(tilejson), {maxZoom: 8});
            map.addLayer(geojsonLayer);

            geojsonLayer.on("featureparse", function (e) {
                if (e.properties && e.properties.state){
                    e.layer.bindPopup(e.properties.state+': '+e.properties.party+': $'+e.properties.amount);
                }
                if (e.properties && e.properties.amount) {
                    e.layer.setRadius(Math.sqrt(e.properties.amount) / 70);
                }
                if (e.properties && e.properties.style && e.layer.setStyle) {
                    e.layer.setStyle(e.properties.style);
                }
            });
            geojsonLayer.addGeoJSON(indexp_data);
        });
        return map;
    };

    var map_senate = create_map1();


    var create_map2 = function() {
        var indexp_data = {{ map_geo_json__house_indexp|safe }}
        var url = "http://a.tiles.mapbox.com/v3/arowland-sf.states_new.jsonp?foo=1";
        var map = new L.Map('mapbox_house_indexp', {maxZoom: 8, maxBounds: L.LatLngBounds(new L.LatLng(-168.9258,24.4471), new L.LatLng(-66.1816,60.6360)) }) // container's id="mapbox"
        // Center the map on the lower 48, with zoom at 3
        .setView(new L.LatLng(39.9097,-95.625), 3);

        var geojsonLayer = new L.GeoJSON(null, {
            pointToLayer: function (latlng) {
                return new L.CircleMarker(latlng);
            }
        });

        wax.tilejson(url, function(tilejson) {
            map.addLayer(new wax.leaf.connector(tilejson), {maxZoom: 8});
            map.addLayer(geojsonLayer);

            geojsonLayer.on("featureparse", function (e) {
                if (e.properties && e.properties.state){
                    e.layer.bindPopup(e.properties.state+': '+e.properties.party+': $'+e.properties.amount);
                }
                if (e.properties && e.properties.amount) {
                    e.layer.setRadius(Math.sqrt(e.properties.amount) / 70);
                }
                if (e.properties && e.properties.style && e.layer.setStyle) {
                    e.layer.setStyle(e.properties.style);
                }
            });
            geojsonLayer.addGeoJSON(indexp_data);
        });
        return map;
    };

    var map_house = create_map2();
</script>
{% endblock %}

