{% load humanize %}
{% load influence_extras %}

<div class="overviewBar">
  <a class="toggle">Toggle</a>
  <h3 class="insideBar">Grants and Contracts,
      {% ifequal cycle "-1" %}
        {{ gc_min_year }} &#150; {{ gc_max_year }}
      {% else %}
        {{cycle|add:-1}} &#150; {{cycle}}
      {% endifequal %}</h3>
</div>

<div class="chartModule">

{% if entity_info.totals.contracts_count or entity_info.totals.grants_count %}
<div class="fulltext-disclaimer">Found
     {% if entity_info.totals.contracts_count %}
	  {{ entity_info.totals.contracts_count|apnumber }} contracts
	  {% if entity_info.totals.grants_count %} and {% endif %}
     {% endif %}
     {% if entity_info.totals.grants_count %}
	  {{ entity_info.totals.grants_count|apnumber }} grants
     {% endif %}
     containing the words &ldquo;{{ entity_info.name|standardize_organization_name }}&rdquo;
</div>
{% endif %}

  <table class="threeColumn">
    <thead>
      <tr>
        <th class="type">Type</th>
        <th class="recipient">Recipient Name</th>
		<th class="year">Year</th>
		<th class="agency">Agency</th>
		<th class="description">Description</th>
		<th class="right">Amount</th>
    </thead>
    <tbody>
    {% for row in grants_and_contracts %}
      <tr class="{% cycle 'even' 'odd' %}">
        <td><div class="label-{% if row.type = 'g' %}grant{% else %}contract{% endif %}">{% if row.type = 'g' %}grant{% else %}contract{% endif %}</div></td>
        <td>{{ row.recipient_name|standardize_organization_name }}</td>
	    <td>{{ row.fiscal_year }}</td>
	    <td>{{ row.agency_name|standardize_organization_name }}</td>
	    <td>{{ row.description }}</td>
	    <td class="right">${{ row.amount|floatformat:0|intcomma }}</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
  
  <div class="clear"></div>
  
  <div class="external">
    {% if gc_links %}
    For more information on grants and contracts:
    {% for link in gc_links %}
    <a href="{{ link.url }}" class="external" target="_blank">{{ link.text }}</a>
    {% endfor %}
    {% endif %}
  </div>
  
  <div class="clear"></div>
</div><!-- end chartModule -->
