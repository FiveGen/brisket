{% extends "entity_base.html" %}
{% load humanize %}

{% block extrajs %}
<script type="text/javascript" charset="utf-8"> 
$(document).ready(function() {
  piechart("piechart_level", {{ level_breakdown|safe }});
  piechart("piechart_party", {{ party_breakdown|safe }}, type="party" );  
  barchart("recipients_barchart", {{ recipients_barchart_data|safe }});  
  sparkline("sparklines", {{ sparkline_data|safe }});
});
</script>
{% endblock %}

{% block contentHeader %}
<h2>{{ entity_info.name }}</h2>
{% endblock %}

{% block contrib_overview_amount %}
{% if entity_info.totals.contributor_amount %}
${{entity_info.totals.contributor_amount|floatformat:-1|intcomma }} Given
{% endif %}
{% endblock %}

{% block charts %}

<div class="twoColumn chartWrapper"> 
  <div class="chart"> 
    <h4>Top Recipients</h4>
    <div class="graph" id="recipients_barchart">
      <!-- raphael charts here -->
    </div>    
  </div>
</div>

<div class="clear"></div> <!-- start a new row -->

<div class="oneColumn chartWrapper">
  <div class="chart">
    <h4 class="withTip">Republicans vs. Democrats</h4>
    <span class="tip">in dollars</span>
    <div class="graph" id="piechart_party">
      <!-- raphael charts here -->
    </div>
  </div>
</div>

<div class="oneColumn chartWrapper">
  <div class="chart">
    <h4 class="withTip">State vs. Federal</h4>
    <span class="tip">in dollars</span>
    <div class="graph" id="piechart_level">
      <!-- raphael charts here -->
    </div>
  </div>
</div>

{% endblock %}


{% block lobbying_hired_amount %}
{% if entity_info.totals.client_amount %} 
    ${{ entity_info.totals.client_amount|floatformat:-1|intcomma }} hired
{% endif %}
{% endblock %}

{% block lobbying_executed_amount %}
{% if entity_info.totals.registrant_amount %} 
    ${{ entity_info.totals.registrant_amount|floatformat:-1|intcomma }} executed
{% endif %}
{% endblock %}

{% block lobbying_tables %}

{% if lobbying_for_org %}
<div class="twoColumn chartWrapper">
  <h4>Lobbying On Behalf of {{ entity_info.name }}</h4>
  {% if lobbyists_on_behalf_of_org %}
  <b>Lobbied for this organization's issues</b>:
  <p id="description" class="clear">
  {% for row in lobbyists_on_behalf_of_org %}
  {% if row.lobbyist_entity %}
  <a href="/individual/{{ row.lobbyist_name|slugify }}/{{ row.lobbyist_entity }}?cycle={{cycle}}"> 
    {{ row.lobbyist_name }}
  </a>
  {% else %}
  {{ row.lobbyist_name }}
  {% endif %}
  {% if not forloop.last %}, {% endif %}
  {% endfor %}
  </p>
  {% endif %}

  <table class="twoColumn">
    <thead>
      <tr id="titles">
        <th class="left">Firm Hired</th>
        <th class="right">Amount</th>
      </tr>
    </thead>
    <tbody>
      {% for row in lobbying_for_org %}
      <tr class="{% cycle 'even' 'odd' %}">
        <td>	    
	  {% if row.registrant_entity %}
	  <a href="/organization/{{ row.registrant_name|slugify }}/{{ row.registrant_entity }}?cycle={{cycle}}">{{ row.registrant_name }}</a>
	  {% else %}
	  {{ row.registrant_name }}
          {% endif %} 
        </td>
        <td class="right">${{ row.amount|floatformat:-1|intcomma }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% if issues_lobbied_for %}
  <p id="description" class="clear">
    Issues Lobbied:     
    {{ issues_lobbied_for|join:", " }}
  </p>
  {% endif %}
</div>
{% endif %}

{% if lobbying_by_org %}
<div class="twoColumn chartWrapper">
  <h4>Lobbying Carried Out by {{ entity_info.name }}</h4>
  {% if lobbyists_as_employees_of_org %}
  <div>
    <b>Lobbyists Employed by this Organization:</b>
    <p id="description" class="clear">
      {% for row in lobbyists_as_employees_of_org %}
      {% if row.lobbyist_entity %}
      <a href="/individual/{{ row.lobbyist_name|slugify }}/{{ row.lobbyist_entity }}?cycle={{cycle}}"> 
	{{ row.lobbyist_name }}
      </a>
      {% else %}
      {{ row.lobbyist_name }}
      {% endif %}
      {% if not forloop.last %}, {% endif %}
      {% endfor %}
    </p>
    {% endif %}
  </div>

  <table class="twoColumn">
    <thead>
      <tr id="titles">
        <th class="left">Customer</th>
        <th class="right">Amount</th>
      </tr>
    </thead>
    <tbody>
      {% for row in lobbying_by_org %}
      <tr class="{% cycle 'even' 'odd' %}">
        <td>	    
	  {% if row.client_entity %}
	  <a href="/organization/{{ row.client_name|slugify }}/{{ row.client_entity }}?cycle={{cycle}}">{{ row.client_name }}</a>
	  {% else %}
	  {{ row.client_name }}
          {% endif %} 
        </td>
        <td class="right">${{ row.amount|floatformat:-1|intcomma }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% if issues_lobbied_by %}
  <p id="description" class="clear">
    Issues Lobbied:     
    {{ issues_lobbied_by|join:", " }}
  </p>
  {% endif %}
</div>
{% endif %}

{% endblock %}
