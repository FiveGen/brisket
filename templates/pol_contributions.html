{% load humanize %}
{% load influence_extras %}

{% if section.fec_summary %}
<li class="oneColumn">
    <h4 class="withTip">FEC Summary</h4>
    <span class="tip">The latest tallies straight from the FEC.</span>
    <table>
        <tr>
            <th>Type</th>
            <th>Amount</th>
        </tr>
        <tr class="even">
            <td>Individuals Contributions</td>
            <td>${{ section.fec_summary.contributions_indiv|floatformat:0|intcomma }}</td>
        </tr>
        <tr class="odd">
            <td>PAC Contributions</td>
            <td>${{ section.fec_summary.contributions_pac|floatformat:0|intcomma }}</td>
        </tr>
        <tr class="even">
            <td>Party Contributions</td>
            <td>${{ section.fec_summary.contributions_party|floatformat:0|intcomma }}</td>
        </tr>
        <tr class="odd">
            <td>Candidate Self-Financing</td>
            <td>${{ section.fec_summary.contributions_candidate|floatformat:0|intcomma }}</td>
        </tr>
        <tr class="even">
            <td>Incoming Transfers</td>
            <td>${{ section.fec_summary.transfers_in|floatformat:0|intcomma }}</td>
        </tr>
        <tr class="odd">
            <td>Disbursements</td>
            <td>${{ section.fec_summary.disbursements|floatformat:0|intcomma }} ({{section.fec_summary.total_disbursements_rank}} out of {{section.fec_summary.max_rank}})</td>
        </tr>
        <tr class="even">
            <td>Total Raised</td>
            <td>${{ section.fec_summary.total_raised|floatformat:0|intcomma }} ({{section.fec_summary.total_receipts_rank}} out of {{section.fec_summary.max_rank}})</td>
        </tr>
        <tr class="odd">
            <td>Cash on Hand</td>
            <td>${{ section.fec_summary.cash_on_hand|floatformat:0|intcomma }} ({{section.fec_summary.cash_on_hand_rank}} out of {{section.fec_summary.max_rank}})</td>
        </tr>
    </table>
</li>
<li class="twoColumn">
    <h4 class="withTip">Contributions Over Time</h4>
    <span class="tip">How this candidate's receipts compare to competitors in this election cycle.</span>
    <div id="fec_linechart"></div>
</li>
<div class="clear"></div>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
(function() {
    var fec_data = {{ section.fec_timelines|safe }};
    google.load("visualization", "1", {packages:["corechart"]});
    google.setOnLoadCallback(function() {
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Week');
        var longest = 0;
        _.each(fec_data, function(pol) {
            data.addColumn('number', pol.name);
            if (pol.timeline.length > longest) {
                longest = pol.timeline.length;
            }
        })
        data.addRows(longest);
        for (var i = 0; i < longest; i++) {
            data.setValue(i, 0, "Week " + (i + 1));
        }
        _.each(fec_data, function(pol, idx) {
            for (var i = 0; i < pol.timeline.length; i++) {
                data.setValue(i, idx + 1, pol.timeline[i]);
            }
        });

        var chart = new google.visualization.LineChart(document.getElementById('fec_linechart'));
        chart.draw(data, {width: 520, height: 300, chartArea: {left: 75, width: 275}, vAxis: {minValue: 0}, hAxis: {textPosition: 'none'}});
    });
})();
</script>


{% endif %}

<li class="twoColumn chart">
    {% if section.industries_barchart_data %}
    <h4 class="withTip">Top Industries</h4>
    <span class="tip">OpenSecrets.org and FollowTheMoney.org classify contribution data into about 100 <a href="http://www.opensecrets.org/lobby/list_indus.php">industries</a>.</span>
    <div class="graph" id="industries_barchart">
      <!-- raphael charts -->
    </div>
    <span class="tip">{{ section.pct_known }}% of the total amount raised came from an identifiable industry.</span>
    {% endif %}
</li>

<li class="oneColumn chart">
    <h4 class="withTip">In State vs. Out of State</h4>
    <span class="tip">contributions from individuals, in dollars</span>
    <div class="graph piechart" id="piechart_local">
      <!-- raphael charts -->
    </div>
</li>

<li class="oneColumn chart">
    <h4 class="withTip">Individuals vs. PACs</h4>
    <span class="tip">in dollars</span>
    <div class="graph piechart" id="piechart_entity">
      <!-- raphael charts -->
    </div>
</li>

<li class="twoColumn chart">
    {% if section.contributors_barchart_data %}
    <h4 class="withTip key">Top Contributors</h4>
    <dl class="key">
        <dt class="employees">Employee Color Block</dt>
        <dd>Employees</dd>

        <dt class="pac">PAC Color Block</dt>
        <dd>PAC</dd>
    </dl>
    <div class="clear"></div>
    <span class="tip">Includes contributions from an organizationâ€™s employees, their family members, and its political action committee.</span>
    <div class="graph" id="contributors_barchart">
      <!-- raphael charts -->
    </div>
    {% endif %}
</li>

{% if section.bundling_data %}
    <li class="twoColumn">
        <h4 class="withTip">Bundled Lobbyist Contributions</h4>
        <span class="tip">Lobbyists and lobbying firms that raised money from multiple donors on behalf of the politician. Contributions from the lobbyist or firm itself are not included.</span>
        <table class="twoColumn">
            <thead>
                <tr>
                    <th>Bundler</th>
                    <th>Amount</th>
                </tr> 
            </thead>
            <tbody>
            {% for lobbyist_entity, lobbyist_name, firm_entity, firm_name, amount in section.bundling_data %}
            <tr class="{% cycle 'even' 'odd' %}">
                <td>
                    {% if lobbyist_entity and lobbyist_entity != firm_entity %}
                    <a href="/individual/{{lobbyist_name|slugify}}/{{lobbyist_entity}}">{{ lobbyist_name|standardize_individual_name }}</a>,
                    {% endif %}
                    {% if firm_entity %}<a href="/organization/{{firm_name|slugify}}/{{firm_entity}}">{% endif %}{{ firm_name|standardize_organization_name }}{% if firm_entity %}</a>{% endif %}
                </td>
                <td>${{ amount|floatformat:0|intcomma }}</td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </li>
{% endif %}

{% if section.partytime_data %}
    {% if section.partytime_data.past or section.partytime_data.upcoming %}
    <li class="twoColumn chartWrapper">
        <h4 class="withTip">Recent and upcoming fundraisers</h4>
        {% for link in section.external_links %}
            {% if 'Party Time' in link.text %}
                <span class="tip">Full invitations can be viewed at <a href="{{ link.url }}" target="_blank">Party Time</a></span>
            {% endif %}
        {% endfor %}
        <table class="twoColumn">
            <thead>
                <tr id="partyTime">
                    <th>Date</th>
                    <th>Event</th>
                </tr>
            </thead>
            <tbody>
            {% for type, events in section.partytime_data.items %}
              {% for row in events %}
                <tr class="{% cycle 'even' 'odd' %} {{ type }}">
                  <td>{{ row.date|date }}</td>
                  <td>
                    <dl>
                      <dt>Venue:</dt> 
                      <dd>{{ row.fields.entertainment }} at {{ row.fields.venue }}</dd>
                  
                      {% if row.fields.hosts %}
                        <dt class="clear">Hosted by:</dt>
                        <dd>
                        {% for host in row.fields.hosts %}
                          {{ host }}{% if not forloop.last %}, {% endif %}
                        {% endfor %}
                        </dd>
                      {% endif %}
                  </td>
                </tr>
              {% endfor %}
            {% endfor %}
          </tbody>
      </table>
  </li>
  {% endif %}
{% endif %}

<div class="clear"></div>
